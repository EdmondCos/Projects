CREATE DATABASE CAMPIONAT;
USE CAMPIONAT;

CREATE TABLE CLASAMENT (
NUME_ECHIPA VARCHAR(50) NOT NULL,
NR_MECIURI INT,
NR_CASTIGATE INT,
NR_EGAL INT,
NR_PIERDUTE INT,
NR_PUNCTE INT);

ALTER TABLE CLASAMENT ADD PRIMARY KEY(NUME_ECHIPA);

INSERT INTO CLASAMENT (NUME_ECHIPA, NR_MECIURI, NR_CASTIGATE, NR_EGAL, NR_PIERDUTE, NR_PUNCTE) VALUES
("UNIV CRAIOVA", 8, 4, 3, 1, 15),
("POLI TIMISOARA", 8, 3, 2, 3, 11),
("FARUL CONSTANTA", 7, 2, 1, 4, 7),
("FC BRASOV", 8, 2, 3, 3, 9),
("STEAUA BUCURESTI", 7, 5, 0, 2, 15),
("RAPID BUCURESTI", 8, 2, 2, 4, 8);

SELECT * FROM CLASAMENT ORDER BY NR_PUNCTE DESC;

CREATE TABLE JUCATORI (
ID_JUCATOR INT NOT NULL PRIMARY KEY,
NUME_JUCATOR VARCHAR(50) NOT NULL,
NUME_ECHIPA VARCHAR(50) NOT NULL,
POZITIE ENUM ('A', 'M', 'F', 'P'),
NR_TRICOU INT NOT NULL);

ALTER TABLE JUCATORI ADD FOREIGN KEY(NUME_ECHIPA) REFERENCES CLASAMENT(NUME_ECHIPA);
ALTER TABLE JUCATORI DROP PRIMARY KEY;
ALTER TABLE JUCATORI DROP COLUMN ID_JUCATOR;
ALTER TABLE JUCATORI CHANGE ID_JUCATOR NUME_JUCATOR VARCHAR(50);
ALTER TABLE JUCATORI ADD PRIMARY KEY(NUME_JUCATOR);

ALTER TABLE JUCATORI CHANGE NUME_JUCATOR NUME_JUCATOR VARCHAR(50) UNIQUE;

DESCRIBE JUCATORI;

INSERT INTO JUCATORI (NUME_JUCATOR, NUME_ECHIPA, POZITIE, NR_TRICOU) VALUES
("GICA HAGI", "FARUL CONSTANTA", "A", 10),
("FLORIN RADUCIOIU", "RAPID BUCURESTI", "A", 9),
("ILIE DUMIRESCU", "FC BRASOV", "M", 8),
("CORNEL DINU", "FC BRASOV", "M", 7),
("MIODRAG BELODEDICI", "STEAUA BUCURESTI", "M", 6),
("RAZVAN RAT", "UNIV CRAIOVA", "F", 5),
("VLAD CHIRICHES", "UNIV CRAIOVA", "F", 4),
("GICA POPESCU", "FARUL CONSTANTA", "F", 3),
("DAN PETRESCU", "RAPID BUCURESTI", "F", 2),
("FLORIN PRUNEA", "STEAUA BUCURESTI", "P", 1);

CREATE TABLE CLASAMENT_GOLURI (
NUME_JUCATOR INT NOT NULL PRIMARY KEY,
NR_GOLURI INT);

ALTER TABLE CLASAMENT_GOLURI MODIFY COLUMN NUME_JUCATOR VARCHAR(50);
ALTER TABLE CLASAMENT_GOLURI ADD FOREIGN KEY(NUME_JUCATOR) REFERENCES JUCATORI(NUME_JUCATOR);
ALTER TABLE CLASAMENT_GOLURI MODIFY COLUMN NR_GOLURI INT NOT NULL DEFAULT 0;
DESCRIBE CLASAMENT_GOLURI;

SELECT * FROM CLASAMENT_GOLURI;
SHOW TABLES;

INSERT INTO CLASAMENT_GOLURI (NUME_JUCATOR, NR_GOLURI) VALUES
("GICA HAGI", 5),
("FLORIN RADUCIOIU", 12),
("ILIE DUMIRESCU", 7),
("CORNEL DINU", 2),
("MIODRAG BELODEDICI", 0),
("RAZVAN RAT", 2),
("VLAD CHIRICHES", 1),
("GICA POPESCU", 3),
("DAN PETRESCU", 3),
("FLORIN PRUNEA", 0);

SELECT * FROM CLASAMENT_GOLURI ORDER BY NR_GOLURI DESC;

CREATE TABLE CLASAMENT_ASSIST (
NUME_JUCATOR VARCHAR(50) NOT NULL PRIMARY KEY,
NR_ASSIST INT);

DESCRIBE CLASAMENT_ASSIST;
ALTER TABLE CLASAMENT_ASSIST MODIFY COLUMN NR_ASSIST INT NOT NULL DEFAULT 0;
ALTER TABLE CLASAMENT_ASSIST ADD FOREIGN KEY(NUME_JUCATOR) REFERENCES JUCATORI(NUME_JUCATOR);


INSERT INTO CLASAMENT_ASSIST (NUME_JUCATOR, NR_ASSIST) VALUES
("GICA HAGI", 13),
("FLORIN RADUCIOIU", 4),
("ILIE DUMIRESCU", 7),
("CORNEL DINU", 4),
("MIODRAG BELODEDICI", 2),
("RAZVAN RAT", 5),
("VLAD CHIRICHES", 0),
("GICA POPESCU", 3),
("DAN PETRESCU", 4),
("FLORIN PRUNEA", 1);

SELECT * FROM CLASAMENT_ASSIST;

SHOW CREATE TABLE JUCATORI;
ALTER TABLE JUCATORI DROP FOREIGN KEY JUCATORI_IBFK_1;
ALTER TABLE JUCATORI ADD FOREIGN KEY(NUME_ECHIPA) REFERENCES CLASAMENT(NUME_ECHIPA) ON DELETE CASCADE ON UPDATE CASCADE;

SHOW CREATE TABLE CLASAMENT_GOLURI;
ALTER TABLE CLASAMENT_GOLURI DROP FOREIGN KEY CLASAMENT_GOLURI_IBFK_1;
ALTER TABLE CLASAMENT_GOLURI ADD FOREIGN KEY(NUME_JUCATOR) REFERENCES JUCATORI(NUME_JUCATOR) ON DELETE CASCADE ON UPDATE CASCADE;

SHOW CREATE TABLE CLASAMENT_ASSIST;
ALTER TABLE CLASAMENT_ASSIST DROP FOREIGN KEY CLASAMENT_ASSIST_IBFK_1;
ALTER TABLE CLASAMENT_ASSIST ADD FOREIGN KEY(NUME_JUCATOR) REFERENCES JUCATORI(NUME_JUCATOR) ON DELETE CASCADE ON UPDATE CASCADE;

DELETE FROM JUCATORI WHERE NUME_JUCATOR = 'GICA HAGI';

SELECT * FROM JUCATORI;
SELECT * FROM CLASAMENT_GOLURI;
SELECT * FROM CLASAMENT_ASSIST;

SELECT MAX(NR_ASSIST) FROM CLASAMENT_ASSIST;
SELECT NUME_JUCATOR FROM CLASAMENT_ASSIST WHERE NR_ASSIST = (SELECT MAX(NR_ASSIST) FROM CLASAMENT_ASSIST);

INSERT INTO CLASAMENT_ASSIST (NUME_JUCATOR, NR_ASSIST) SELECT CONCAT(E.NUME_JUCATOR, '-DUPLICATE'), E.NR_ASSIST FROM 
	(SELECT NUME_JUCATOR, NR_ASSIST FROM CLASAMENT_ASSIST WHERE NR_ASSIST = (SELECT MAX(NR_ASSIST) FROM CLASAMENT_ASSIST)) E;
    
SHOW CREATE TABLE CLASAMENT_ASSIST;
ALTER TABLE CLASAMENT_ASSIST DROP FOREIGN KEY CLASAMENT_ASSIST_IBFK_1;

SELECT NUME_JUCATOR, NR_GOLURI FROM CLASAMENT_GOLURI WHERE NR_GOLURI = (SELECT MAX(NR_GOLURI) FROM CLASAMENT_GOLURI);

INSERT INTO CLASAMENT_GOLURI (NUME_JUCATOR, NR_GOLURI)
	SELECT 'GOALGETER2', Z.NR_GOLURI FROM
	(SELECT NUME_JUCATOR, MAX(NR_GOLURI) AS 'NR_GOLURI' FROM CLASAMENT_GOLURI) Z;

ALTER TABLE CLASAMENT_GOLURI DROP FOREIGN KEY CLASAMENT_GOLURI_IBFK_1;


